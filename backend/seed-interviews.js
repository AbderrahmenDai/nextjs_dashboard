require('dotenv').config();
const db = require('./config/db');
const { v4: uuidv4 } = require('uuid');

async function seed() {
    try {
        console.log('Seeding Interviews...');

        // Get Candidates
        const [candidates] = await db.query("SELECT id FROM Candidature");
        if (candidates.length === 0) {
            console.log("No candidates found. Please seed candidatures first.");
            process.exit(0);
        }

        // Get Users (Interviewers)
        const [users] = await db.query("SELECT id FROM User");
        if (users.length === 0) {
            console.log("No users found. Please seed users first.");
            process.exit(0);
        }

        const interviewTypes = ['RH', 'Technique', 'Manager', 'Validation'];
        const results = ['Pending', 'Passed', 'Failed'];
        const statuses = ['Scheduled', 'Completed', 'Cancelled'];

        const interviews = [];

        for (let i = 0; i < 10; i++) {
            const candidate = candidates[Math.floor(Math.random() * candidates.length)];
            const interviewer = users[Math.floor(Math.random() * users.length)];
            const type = interviewTypes[Math.floor(Math.random() * interviewTypes.length)];
            const status = statuses[Math.floor(Math.random() * statuses.length)];
            let result = 'Pending';
            
            if (status === 'Completed') {
                result = Math.random() > 0.3 ? 'Passed' : 'Failed';
            }

            interviews.push([
                uuidv4(),
                candidate.id,
                interviewer.id,
                new Date(Date.now() + Math.random() * 86400000 * 7), // Next 7 days
                'Face-to-Face',
                type,
                status,
                result,
                'Generated by seed script'
            ]);
        }

        await db.query(`
            INSERT IGNORE INTO Interview (id, candidatureId, interviewerId, date, mode, type, status, result, notes) 
            VALUES ?
        `, [interviews]);

        console.log('✅ Seeding completed.');
    } catch (error) {
        console.error('❌ Seeding failed:', error);
    } finally {
        process.exit(0);
    }
}

seed();
